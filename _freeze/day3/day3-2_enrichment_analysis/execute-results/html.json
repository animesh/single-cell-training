{
  "hash": "916a558cdd277e1a8016e7b57a4b5601",
  "result": {
    "markdown": "---\ntitle: \"Enrichment analysis\"\n---\n\n\n## Material\n\n- [MSigDB](http://www.gsea-msigdb.org/gsea/msigdb/index.jsp)\n- `clusterProfiler` [vignette](https://bioconductor.org/packages/release/bioc/vignettes/clusterProfiler/inst/doc/clusterProfiler.html)\n- [Revigo](http://revigo.irb.hr/)\n- [Signaling Pathway Impact Analysis (SPIA)](https://bioconductor.org/packages/release/bioc/html/SPIA.html)\n- Original [paper](https://www.pnas.org/content/102/43/15545) on GSEA\n- [STRING](https://string-db.org/) for protein-protein interactions\n- [GO figure!](https://gitlab.com/evogenlab/GO-Figure) for plotting GO terms and the associated [paper](https://www.frontiersin.org/articles/10.3389/fbinf.2021.638255/full)\n\n## Exercises\n\n\n::: {.cell hash='day3-2_enrichment_analysis_cache/html/unnamed-chunk-1_96bb9c307a766312b880096273847e1c'}\n\n:::\n\n\nLoad the following packages:\n\n\n::: {.cell hash='day3-2_enrichment_analysis_cache/html/unnamed-chunk-2_02e7d4ff1a63ade0bd19ade403372a3e'}\n\n```{.r .cell-code}\nlibrary(clusterProfiler)\nlibrary(enrichplot)\n```\n:::\n\n\nIf the `FindMarkers` or `FindAllMarkers` functions were used,\nwe obtained a table listing only the significant genes,\nbut we don't have any information of fold change for the non-significant\ngenes. Therefore, we can use the over-representation analysis\nwhich is a threshold-based method.\nUsing our list of significant genes, we can test\nif any gene set is over-represented among significant genes or not using a test\nsimilar to a Fisher test to compare differences in proportions.\n\nThe `clusterProfiler` package provides functions for over-representation\nanalysis of Gene Ontology gene sets (among other functions, including functions for actual GSEA) or KEGG gene sets.\n\nGenes can be labeled using different types of labels, eg\nsymbol, Ensembl ID, Entrez ID. To list the allowed\nlabel types use:\n\n\n::: {.cell hash='day3-2_enrichment_analysis_cache/html/unnamed-chunk-3_48e68a745172b2bac1b9397eb4f0092c'}\n\n```{.r .cell-code}\nBiocManager::install(\"org.Hs.eg.db\", update = FALSE)\nlibrary(org.Hs.eg.db)\nAnnotationDbi::keytypes(org.Hs.eg.db)\n```\n:::\n\n\n::: {.callout-info}\n## About OrgDb\nFor other organisms, you can find available OrgDbs at [bioconductor](http://bioconductor.org/packages/release/BiocViews.html#___OrgDb)\n:::\n\nLet's select a set of genes that are downregulated in the tumor cells compared to normal:\n\n\n::: {.cell hash='day3-2_enrichment_analysis_cache/html/unnamed-chunk-4_a2672608372d02d1601249f570ec9f89'}\n\n```{.r .cell-code}\ntum_down  <- subset(limma_de,\n                    limma_de$logFC < -1 \n                      & limma_de$adj.P.Val <  0.05)\ntum_down_genes <- rownames(tum_down)\n```\n:::\n\n\nWe can do a Gene Ontology term over-representation analysis based on this set of genes. Make sure you check out the help of this function to understand its arguments:\n\n\n::: {.cell hash='day3-2_enrichment_analysis_cache/html/unnamed-chunk-5_e042612c15926b8033c9d7642e47922a'}\n\n```{.r .cell-code}\n?enrichGO\n```\n:::\n\n::: {.cell hash='day3-2_enrichment_analysis_cache/html/unnamed-chunk-6_d589e167429ec9721ba85e82d306b491'}\n\n```{.r .cell-code}\ntum_vs_norm_go <- clusterProfiler::enrichGO(tum_down_genes,\n                                            \"org.Hs.eg.db\",\n                                            keyType = \"SYMBOL\",\n                                            ont = \"BP\",\n                                            minGSSize = 50)\n```\n:::\n\n\nThe results are stored in the `@result` slot:\n\n\n::: {.cell hash='day3-2_enrichment_analysis_cache/html/unnamed-chunk-7_5fa4019b0003deef425a985e14d2b266'}\n\n```{.r .cell-code}\nView(tum_vs_norm_go@result)\n```\n:::\n\n::: {.cell hash='day3-2_enrichment_analysis_cache/html/unnamed-chunk-8_99db7407d3b8a4ea2fd0fdc8ad862add'}\n::: {.cell-output-display}\n|           |ID         |Description                          |GeneRatio |BgRatio   | pvalue| p.adjust| qvalue|\n|:----------|:----------|:------------------------------------|:---------|:---------|------:|--------:|------:|\n|GO:0007059 |GO:0007059 |chromosome segregation               |105/809   |424/18870 |      0|        0|      0|\n|GO:0098813 |GO:0098813 |nuclear chromosome segregation       |79/809    |312/18870 |      0|        0|      0|\n|GO:0000070 |GO:0000070 |mitotic sister chromatid segregation |62/809    |184/18870 |      0|        0|      0|\n|GO:0000819 |GO:0000819 |sister chromatid segregation         |67/809    |225/18870 |      0|        0|      0|\n|GO:0140014 |GO:0140014 |mitotic nuclear division             |71/809    |274/18870 |      0|        0|      0|\n|GO:0000280 |GO:0000280 |nuclear division                     |88/809    |441/18870 |      0|        0|      0|\n:::\n:::\n\n\n::: {.callout-note}\n## The columns `GeneRatio` and `BgRatio`\nThe columns `GeneRatio` and `BgRatio` that are in the `enrichResult` object represent the numbers that are used as input for the Fisher's exact test. \n\nThe two numbers (M/N) in the `GeneRatio` column are:\n\n* M: Number of genes of interest (in our case `tum_down_genes`) that are in the GO set\n* N: Number of genes of interest with any GO annoation.\n\nThe two numbers (k/n) in the `BgRatio` column are:\n\n* k: Number of genes in the universe that are in the GO set\n* n: Number of genes in the universe with any GO annoation\n\nA low p-value resulting from the Fisher's exact means that M/N is signficantly greater than k/n. \n:::\n\nSome GO terms seem redundant because they contain many of the same genes, which is a characteristic of Gene Ontology gene sets. We can simplify this list by removing redundant gene sets:\n\n\n::: {.cell hash='day3-2_enrichment_analysis_cache/html/unnamed-chunk-9_c0e7057d2f4134cbfa716f9d1b9306a5'}\n\n```{.r .cell-code}\nenr_go <- clusterProfiler::simplify(tum_vs_norm_go)\n```\n:::\n\n::: {.cell hash='day3-2_enrichment_analysis_cache/html/unnamed-chunk-10_3f3b6339df4de19309abd92192dcbba9'}\n\n```{.r .cell-code}\nView(enr_go@result)\n```\n:::\n\n::: {.cell hash='day3-2_enrichment_analysis_cache/html/unnamed-chunk-11_5e1af7316c01c3f0221e2927afe99bb7'}\n::: {.cell-output-display}\n|           |ID         |Description                          |GeneRatio |BgRatio   | pvalue| p.adjust| qvalue|\n|:----------|:----------|:------------------------------------|:---------|:---------|------:|--------:|------:|\n|GO:0007059 |GO:0007059 |chromosome segregation               |105/809   |424/18870 |      0|        0|      0|\n|GO:0098813 |GO:0098813 |nuclear chromosome segregation       |79/809    |312/18870 |      0|        0|      0|\n|GO:0000070 |GO:0000070 |mitotic sister chromatid segregation |62/809    |184/18870 |      0|        0|      0|\n|GO:0000280 |GO:0000280 |nuclear division                     |88/809    |441/18870 |      0|        0|      0|\n|GO:0044772 |GO:0044772 |mitotic cell cycle phase transition  |77/809    |470/18870 |      0|        0|      0|\n|GO:0051983 |GO:0051983 |regulation of chromosome segregation |40/809    |131/18870 |      0|        0|      0|\n:::\n:::\n\n\nWe can quite easily generate a plot called an enrichment map with the `enrichplot` package:\n\n\n::: {.cell hash='day3-2_enrichment_analysis_cache/html/unnamed-chunk-12_3a67d3d3f3caafedfd630cf4456325b0'}\n\n```{.r .cell-code}\nenrichplot::emapplot(enrichplot::pairwise_termsim(enr_go),\n                     showCategory = 30,\n                     cex.params = list(category_label = 0.5))\n```\n\n::: {.cell-output-display}\n![](day3-2_enrichment_analysis_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nInstead of testing for Gene Ontology terms, we can also test for other gene set collections. For example the Hallmark collection from [MSigDB](http://www.gsea-msigdb.org/gsea/msigdb/index.jsp):\n\n\n::: {.cell hash='day3-2_enrichment_analysis_cache/html/unnamed-chunk-13_3133571032a826f94cddbb614b8bb197'}\n\n```{.r .cell-code}\ngmt <- msigdbr::msigdbr(species = \"human\", category = \"H\")\n```\n:::\n\n\nWe can use the function `enricher` to test for over-representation of any set of genes of the Hallmark collection. We have to include the \"universe\", i.e. the full list of background, non significant genes, against which to test for differences in proportions:\n\n\n::: {.cell hash='day3-2_enrichment_analysis_cache/html/unnamed-chunk-14_72b43dd4a7e61f6179f2eec5588fa4df'}\n\n```{.r .cell-code}\ntum_vs_norm_enrich <- clusterProfiler::enricher(gene = tum_down_genes,\n                                                universe = rownames(proB),\n                                                pAdjustMethod = \"BH\",\n                                                pvalueCutoff  = 0.05,\n                                                qvalueCutoff  = 0.05,\n                                                TERM2GENE = gmt[,c(\"gs_name\", \"gene_symbol\")])\n```\n:::\n\n\nWhen using the genes down-regulated in tumor, among the over-represented Hallmark gene sets, we have `HALLMARK_G2M_CHECKPOINT`, which includes genes involved in the G2/M checkpoint in the progression through the cell division cycle.\n\n\n::: {.cell hash='day3-2_enrichment_analysis_cache/html/unnamed-chunk-15_fb8ff139c3fc112489a58e10037e7369'}\n\n```{.r .cell-code}\nView(tum_vs_norm_enrich@result[tum_vs_norm_enrich@result$p.adjust < 0.05,])\n```\n:::\n\n::: {.cell hash='day3-2_enrichment_analysis_cache/html/unnamed-chunk-16_057a0d82b4745a6bda22d40e525131fc'}\n::: {.cell-output-display}\n|                                |ID                              |Description                     |GeneRatio |BgRatio  |    pvalue|  p.adjust|    qvalue|\n|:-------------------------------|:-------------------------------|:-------------------------------|:---------|:--------|---------:|---------:|---------:|\n|HALLMARK_E2F_TARGETS            |HALLMARK_E2F_TARGETS            |HALLMARK_E2F_TARGETS            |80/344    |195/3866 | 0.0000000| 0.0000000| 0.0000000|\n|HALLMARK_G2M_CHECKPOINT         |HALLMARK_G2M_CHECKPOINT         |HALLMARK_G2M_CHECKPOINT         |67/344    |188/3866 | 0.0000000| 0.0000000| 0.0000000|\n|HALLMARK_MITOTIC_SPINDLE        |HALLMARK_MITOTIC_SPINDLE        |HALLMARK_MITOTIC_SPINDLE        |48/344    |197/3866 | 0.0000000| 0.0000000| 0.0000000|\n|HALLMARK_MYC_TARGETS_V1         |HALLMARK_MYC_TARGETS_V1         |HALLMARK_MYC_TARGETS_V1         |33/344    |194/3866 | 0.0001564| 0.0017991| 0.0016468|\n|HALLMARK_ESTROGEN_RESPONSE_LATE |HALLMARK_ESTROGEN_RESPONSE_LATE |HALLMARK_ESTROGEN_RESPONSE_LATE |28/344    |166/3866 | 0.0005747| 0.0052875| 0.0048398|\n:::\n:::\n\n\n### Clear environment\n\nClear your environment:\n\n\n::: {.cell hash='day3-2_enrichment_analysis_cache/html/unnamed-chunk-17_25d68bcc27fc591b07aef70f1a22dd95'}\n\n```{.r .cell-code}\nrm(list = ls())\ngc()\n.rs.restartR()\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}